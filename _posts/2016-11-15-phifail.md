---
layout: post
type: math
title: The phi accrual failure detector
subtitle: An adaptive failure detection scheme
---

This post is the summary of the paper: _**The $$\varphi$$ accrual failure detector**_ by 
N. Hayashibara, X. Défago, and T.Katayama. In Proc. 23rd IEEE Intl. Symp. on Reliable 
Distributed Systems (SRDS'04), pp. 66-78, Florianópolis, Brazil, October 2004. IEEE CS Press. 

More at: [D2S Laboratory](http://www.coord.c.titech.ac.jp/)

---

## Problem definition

Detecting failure in a distributed system setting is a desirable task for many
obvious reasons. This paper introduces an implementation of an adaptive (accrual) 
failure detector. In this $$\varphi$$ accrual failure detector, the conditions of 
the network is accumulated and used to update the probabilistic model for failure 
suspicion. Compares to the existing models in 2004, which output of suspicion level 
is binary, this implementation has the advantage of returning a real-value suspicion level.
The authors compared their implementation to [Chen Fault Detection](http://chenfd)
and [Bertier Fault Detection](http://bertier). For the benchmark scheme, they 
set up two computers between Japan and Switzerland transferring "heart beat" signal
from Japan. They then later analyzed the collected data over a week and reported
the result.

- **Input**: A set of master processes $$\mathcal{M}$$ and a set of worker 
processes $$\mathcal{W}$$. The master processes are in charge of monitoring the 
worker processes.
- **Output**: An indicator of failure for each worker processes.
- **Assumption**: In this paper, for the shake of simplicity, the authors assumed
that the master processes will never crash. Furthermore, only one worker and one 
master scheme was discussed in this paper.

## Notations

_Note: The setting in this paper is sending heart beat signals from Japan to Switzerland._

| Notation | Explaination |
| :------- | :----------- |
| $$\varphi$$ | Suspection value. Higher value means the higher chance the failure happened. |
| $$\Phi$$ | Hyperparameter. Threshold for $$\varphi$$. |
| $$\Delta_i$$ | "Heart beat" signal period. |
| $$\Delta_{to}$$ | Timeout for transmission. |
| $$\Delta_{tr}$$ | Average transmission time experienced by the messages. |
| $$\alpha$$ | $$\Delta_{tr} \approx \Delta_{i} + \alpha$$ | 
| $$q$$ | Master process that monitors other process for failure dection. |
| $$p$$ | Worker process that sends "heart beat" signals. |
| $$T_D$$ | Time until q begins to suspect p permanently in case of failure happened. |
| $$\lambda_M$$ | Average mistake rate at which a failure detector generates wrong suspicions. |
| $$\lozenge P$$ | Eventually perfect failure detector class. |
| $$ susp\_level_p(t)$$ | Suspicion level of p at time t. |
| $$ T_{high} $$ | Dynamic threshold upperbounds $$susp\_level_p$$. |
| $$ T_{low} $$ | Dynamic threshold lowerbounds $$susp\_level_p$$. |
| $$ T_{last} $$ | The time when thest most recent heart beat was received. |
| $$ t_{now} $$ | The current time. |
| $$ P_{later}(t) $$ | The probability that the next heart beat will arrive 
after $$t$$ time unit since the last one. |

## Method

As mentioned above, this paper proposed an abstract accrual failure detector
and a simple implementation of the idea with only 2 processes. This figure 
illustrates the differences in the conventional failure detection architecture
and the proposed accrual failure detection architecture.

![Accrual Structure]({{site.baseurl}}/img/phifail_istructure.png){:.center} 

The main different in the proproposed architecture is the ability to return
many suspicion levels instead of just binary levels. This scheme enable the system
to perform many action as well as adaptive action based on the suspicion input
level. In the proposed architecture, the _suspicion level_ is represented by
a value called $$\varphi$$. The suspicion level is defined by a logarithmic scale:

$$ \varphi(t_{now}) \triangleq -\log_{10}(P_{later}(t_{now} - T_{last})) $$

This formula is intuitive in the sense that it penaltize the delay $$t_{now} - T_{last}$$
by a log scale of some pre-defined probabilistic model $$P_{later}(t)$$. In this 
paper, the authors defined a threshold $$\Phi$$ for $$\varphi$$. Since this $$\varphi$$
variable is computed in the log-scale, $$\Phi$$ also has logarithmic meaning. Each of
the unit step increase of $$\Phi$$ will lead to ten times confident interval of
failure detection. However, this fact only means that the confident about a failure 
dection is high, it doesn't take into account the _speed_ of the dectection.

The probabilistic model is given by the formula: 

$$ P_{later}(t) = \frac{1}{\sigma \sqrt{2\pi}} \int_{t}^{+\infty} e^{-\frac{(x-\mu)^2}{2\sigma^2}} dx $$

Note that the formula above is just the implementation of the abstract accrual 
failure detector in this paper. Theoretically speaking, we can choose any computable
$$P_{later}{t}$$ that is suitable to our need. The picture below demonstrate this
probabilistic model.

![Accrual Structure]({{site.baseurl}}/img/phifail_plater.png){width="60%" :.center} 

Until this point, we have the suspicion level $$\varphi$$ and the probabilistic
model for computing $$\varphi$$. In order to adapt the network condition
into the failure detection scheme, the authors created a sized window with size
$$WS$$. When the heart beat signal is arrived, it time stamp is stored into
the window. The mean $$\mu$$ and variance $$\sigma^2$$ of the data in the
window is maintained as the window received new data. In addtion, there are
two variable keeping track of sum and sum of square of all element in 
the window are also maintained for computation convenient.
